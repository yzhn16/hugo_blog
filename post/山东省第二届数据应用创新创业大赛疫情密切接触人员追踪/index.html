<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" href="/images/favicon.svg">
    
    <link rel="stylesheet" href="/scss/global.min.21349b939dfaef508f26ef6f31876a6e87bc5a57aefd0e213d17fe4e5192c499.css">
    
    <link rel="stylesheet" href="/css/prism.css" />
    <link href="https://fonts.googleapis.com/css?family=Merriweather&display=swap" rel="stylesheet">
    

 






	




<title>山东省第二届数据应用创新创业大赛——疫情密切接触人员追踪 | yzhn&#39;s Notes</title>
<meta name="description" content="
性能优化赛题，k-d树方案。初赛Rank28，复赛Rank16。">
<meta property="og:title" content="山东省第二届数据应用创新创业大赛——疫情密切接触人员追踪 | yzhn&#39;s Notes">
<meta property="og:site_name" content="yzhn&#39;s Notes">
<meta property="og:description" content="
性能优化赛题，k-d树方案。初赛Rank28，复赛Rank16。">
<meta property="og:url" content="/post/%E5%B1%B1%E4%B8%9C%E7%9C%81%E7%AC%AC%E4%BA%8C%E5%B1%8A%E6%95%B0%E6%8D%AE%E5%BA%94%E7%94%A8%E5%88%9B%E6%96%B0%E5%88%9B%E4%B8%9A%E5%A4%A7%E8%B5%9B%E7%96%AB%E6%83%85%E5%AF%86%E5%88%87%E6%8E%A5%E8%A7%A6%E4%BA%BA%E5%91%98%E8%BF%BD%E8%B8%AA/">
<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:image" content='/uploads/default.jpg'><meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="山东省第二届数据应用创新创业大赛——疫情密切接触人员追踪 | yzhn&#39;s Notes">

	<link rel="canonical" href="/post/%E5%B1%B1%E4%B8%9C%E7%9C%81%E7%AC%AC%E4%BA%8C%E5%B1%8A%E6%95%B0%E6%8D%AE%E5%BA%94%E7%94%A8%E5%88%9B%E6%96%B0%E5%88%9B%E4%B8%9A%E5%A4%A7%E8%B5%9B%E7%96%AB%E6%83%85%E5%AF%86%E5%88%87%E6%8E%A5%E8%A7%A6%E4%BA%BA%E5%91%98%E8%BF%BD%E8%B8%AA/">


	<meta name="twitter:description" content="
性能优化赛题，k-d树方案。初赛Rank28，复赛Rank16。">
<meta name="twitter:image" content="/uploads/default.jpg">
<meta property="article:published_time" content="2021-04-03T23:13:00&#43;00:00">
	<meta property="article:updated_time" content="2021-04-03T23:13:00&#43;00:00">



    </head>


<body class="line-numbers">

    
    <script src="/js/initColors.js"></script>

    <div class="layout-styled">

        <Section class="section">
  <div class="nav-container">
    <a class="logo-link" href="/">
      <div id="logo-desktop">
        <svg
        width="192"
        height="23"
        viewBox="0 0 192 23"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        className="Logo__Desktop"
      >
        <g clipPath="url(#clip0)">
          <path
            d="M120.941 6.15477H122.453V2.83255L124.114 2.44922V6.15477H126.713V7.30477H124.114V16.377C124.114 17.314 124.54 17.7826 125.435 17.7826C125.925 17.7826 126.478 17.6335 126.904 17.4205L127.181 18.4214C126.606 18.7835 125.861 18.9964 124.86 18.9964C123.539 18.9964 122.432 18.3788 122.432 16.5261V7.30477H120.92V6.15477H120.941Z"
            fill="#7A8085"
          />
          <path
            d="M131.739 7.77334C132.825 6.70852 134.273 5.89926 135.764 5.89926C137.723 5.89926 138.937 6.94278 138.937 9.17889V17.6122L140.555 17.8465V18.7409H137.233V9.58352C137.233 7.9863 136.616 7.30482 135.338 7.30482C134.166 7.30482 132.74 8.0076 131.739 8.90204V17.5909L133.442 17.8039V18.7196H128.416V17.8039L130.078 17.5909V1.29926L128.374 1.04371V0.0214844H131.739V7.77334V7.77334Z"
            fill="#7A8085"
          />
          <path
            d="M141.854 12.4374C141.854 7.6883 143.92 5.89941 146.731 5.89941C149.648 5.89941 151.267 7.64571 151.267 11.9689V12.629H143.6C143.621 16.3772 144.686 17.8253 147.284 17.8253C148.605 17.8253 149.584 17.3994 150.5 16.7818L151.096 17.6124C150.01 18.5068 148.754 18.9966 147.008 18.9966C143.941 18.9753 141.854 17.2929 141.854 12.4374ZM143.621 11.5216H149.521C149.521 8.34849 148.754 6.98552 146.709 6.98552C144.857 6.98552 143.771 8.2633 143.621 11.5216Z"
            fill="#7A8085"
          />
          <path
            d="M162.682 7.85849C163.768 6.70849 165.024 5.87793 166.515 5.87793C168.474 5.87793 169.646 6.92145 169.646 9.15756V17.6335L171.286 17.8677V18.6983H167.963V9.68997C167.963 8.07145 167.388 7.32608 166.089 7.32608C164.918 7.32608 163.789 8.02886 162.81 8.9233V17.6122L164.449 17.8464V18.7409H161.127V9.68997C161.127 8.07145 160.552 7.32608 159.253 7.32608C158.082 7.32608 156.953 8.02886 155.973 8.9233V17.6122L157.677 17.8464V18.7409H152.651V17.8464L154.312 17.6122V7.47515L152.609 7.2196V6.15478H155.654L155.888 7.85849C156.974 6.72978 158.188 5.89923 159.679 5.89923C161.212 5.87793 162.277 6.51682 162.682 7.85849Z"
            fill="#7A8085"
          />
          <path
            d="M171.925 12.4374C171.925 7.6883 173.991 5.89941 176.802 5.89941C179.719 5.89941 181.338 7.64571 181.338 11.9689V12.629H173.671C173.692 16.3772 174.757 17.8253 177.355 17.8253C178.676 17.8253 179.655 17.3994 180.571 16.7818L181.167 17.6124C180.081 18.5068 178.825 18.9966 177.079 18.9966C174.012 18.9753 171.925 17.2929 171.925 12.4374ZM173.692 11.5216H179.591C179.591 8.34849 178.825 6.98552 176.78 6.98552C174.928 6.98552 173.863 8.2633 173.692 11.5216Z"
            fill="#7A8085"
          />
          <path
            d="M183.084 18.0383V15.504H184.234L184.618 17.442C185.278 17.7189 185.789 17.8892 186.811 17.8892C188.664 17.8892 189.558 17.0374 189.558 15.5466C189.558 14.0559 188.834 13.4809 186.79 12.8846C184.831 12.2883 183.382 11.4577 183.382 9.13645C183.382 7.39016 184.639 5.89941 187.195 5.89941C188.664 5.89941 189.835 6.17627 190.687 6.68738V9.15775H189.558L189.132 7.34756C188.579 7.09201 187.961 7.00682 187.258 7.00682C185.789 7.00682 184.852 7.7309 184.852 8.98738C184.852 10.3077 185.576 10.8189 187.365 11.3513C189.431 12.0115 191.156 12.7142 191.156 15.3976C191.156 17.7615 189.431 18.9753 186.79 18.9753C185.235 18.9753 183.957 18.6346 183.084 18.0383Z"
            fill="#7A8085"
          />
          <path class="change-fill"
            d="M38.3122 9.98811C38.3122 8.66774 37.9501 8.15663 36.9492 8.15663C36.1186 8.15663 35.0964 8.62515 34.3936 9.20015V16.9733L35.8418 17.165V18.6344H30.0918V17.165L31.5825 16.9733V8.24182L30.0918 7.92237V6.19737H33.9251L34.2446 7.64552C35.3733 6.55941 36.6298 5.87793 38.1418 5.87793C39.9946 5.87793 41.102 6.92145 41.102 9.07237V16.9733L42.5927 17.165V18.6344H38.3122V9.98811V9.98811Z"
            fill="#000"
          />
          <path class="change-fill"
            d="M62.3982 17.1858V18.6553H56.0732V17.1858L57.564 16.9942V8.2627L56.0732 7.94326V6.21826H59.8427L60.226 8.17752C61.0779 6.85715 62.1427 5.94141 63.6973 5.94141C63.8677 5.94141 64.0594 5.9627 64.1871 6.0053L63.8251 8.94418C63.5483 8.81641 63.2501 8.77381 62.8668 8.77381C61.8871 8.77381 61.1418 9.05067 60.3751 9.71085V16.9516L62.3982 17.1858Z"
            fill="#000"
          />
          <path class="change-fill"
            d="M76.7098 6.19733H78.0941V3.08807L80.5432 2.55566V6.21863H82.9709V8.0927H80.5432V15.6742C80.5432 16.5899 80.8839 16.9946 81.6293 16.9946C82.0978 16.9946 82.5876 16.8455 82.907 16.6751L83.3543 18.3575C82.758 18.6983 81.9061 18.9751 80.6709 18.9751C78.9672 18.9751 78.0941 18.1658 78.0941 16.0362V8.0927H76.7098V6.19733Z"
            fill="#000"
          />
          <path class="change-fill"
            d="M90.4664 17.1648V18.6343H84.6738V17.1648L86.1646 16.9731V8.24167L84.6738 7.92222V6.19722H88.9757V16.9731L90.4664 17.1648ZM85.696 1.76759C85.696 0.787963 86.4627 0 87.4423 0C88.422 0 89.1886 0.766667 89.1886 1.76759C89.1886 2.72593 88.422 3.51389 87.421 3.51389C86.4627 3.51389 85.696 2.72593 85.696 1.76759Z"
            fill="#000"
          />
          <path class="change-fill"
            d="M98.3251 7.90097V6.19727H103.053V7.92227L101.924 8.11393L98.3251 18.6556H95.663L92.064 8.09264L90.9991 7.92227V6.19727H96.2593V7.90097L95.0242 8.09264L96.7279 13.6084C97.0473 14.6519 97.1964 15.5037 97.3668 16.4834H97.388C97.5371 15.525 97.7714 14.5241 98.0482 13.5871L99.6668 8.07134L98.3251 7.90097Z"
            fill="#000"
          />
          <path class="change-fill"
            d="M75.6867 17.1224C74.5793 17.1437 74.3664 16.952 74.3664 15.9724V9.79645C74.3664 6.96404 72.9821 5.87793 70.3201 5.87793C68.3821 5.87793 66.7423 6.45293 65.4219 7.28349L66.2312 9.02978C67.3599 8.45478 68.4673 8.09274 69.7238 8.09274C71.1932 8.09274 71.5552 8.88071 71.5552 10.265V11.0316V11.2233V12.7779V12.8844V16.1214C71.0867 16.6326 70.4052 17.0585 69.4469 17.0585C68.3821 17.0585 67.871 16.5261 67.871 15.0353C67.871 13.3103 68.5951 12.8205 70.4904 12.7779V11.2233C66.6358 11.2659 65.0386 12.4372 65.0386 15.2057C65.0386 17.8465 66.4867 18.9752 68.6589 18.9752C70.2136 18.9752 71.0654 18.315 71.7895 17.5696C72.0451 18.5705 72.833 18.9752 73.8978 18.9752C74.6645 18.9752 75.3886 18.7622 75.8571 18.5066L75.6867 17.1224Z"
            fill="#000"
          />
          <path class="change-fill"
            d="M54.4968 17.1224C53.3894 17.1437 53.1764 16.952 53.1764 15.9724V9.79645C53.1764 6.96404 51.7922 5.87793 49.1301 5.87793C47.1922 5.87793 45.5523 6.45293 44.232 7.28349L45.0412 9.02978C46.1699 8.45478 47.2773 8.09274 48.5338 8.09274C50.0033 8.09274 50.3653 8.88071 50.3653 10.265V11.0316V11.2233V12.7779V12.8844V16.1214C49.8968 16.6326 49.2153 17.0585 48.257 17.0585C47.1922 17.0585 46.681 16.5261 46.681 15.0353C46.681 13.3103 47.4051 12.8205 49.3005 12.7779V11.2233C45.4459 11.2659 43.8486 12.4372 43.8486 15.2057C43.8486 17.8465 45.2968 18.9752 47.469 18.9752C49.0236 18.9752 49.8755 18.315 50.5996 17.5696C50.8551 18.5705 51.6431 18.9752 52.7079 18.9752C53.4746 18.9752 54.1986 18.7622 54.6672 18.5066L54.4968 17.1224Z"
            fill="#000"
          />
          <path class="change-fill"
            d="M107.653 13.055H113.594V11.9476C113.594 7.47534 111.869 5.89941 108.803 5.89941C105.63 5.89941 103.628 7.79478 103.628 12.4161C103.628 17.1013 105.523 18.9966 109.058 18.9966C110.954 18.9966 112.231 18.5068 113.467 17.5272L112.657 16.0577C111.678 16.6753 110.868 17.0587 109.463 17.0587C107.546 17.0587 106.801 16.1855 106.63 14.0133C106.588 13.6939 106.567 13.0976 106.567 12.4587C106.567 12.054 106.567 11.6707 106.588 11.3726V11.3513C106.737 8.51886 107.397 7.60312 108.781 7.60312C110.4 7.60312 110.783 8.58275 110.783 11.3513H107.674V13.055H107.653Z"
            fill="#000"
          />
          <path class="change-fill" d="M17.5907 20.2954H0V23H17.5907V20.2954Z" fill="#000" />
          <path class="change-fill"
            d="M0 7.96484V18.9537L5.38796 15.1843V11.7343L0 7.96484Z"
            fill="#000"
          />
          <path class="change-fill"
            d="M17.5689 10.9463V0L12.1597 3.74815V7.13426L17.5689 10.9463Z"
            fill="#000"
          />
          <path class="change-fill"
            d="M17.5907 18.975L17.5694 12.288L0 0V6.62315L17.5907 18.975Z"
            fill="#000"
          />
        </g>
        <defs>
          <clipPath id="clip0">
            <rect width="191.156" height="23" fill="white" />
          </clipPath>
        </defs>
      </svg>
</div>
<div id="logo-mobile" class="hidden">
    <svg version="1.0" xmlns="http://www.w3.org/2000/svg"
    width="23" height="23" viewBox="0 0 512.000000 512.000000"
    preserveAspectRatio="xMidYMid meet">
   <metadata>
   Created by potrace 1.15, written by Peter Selinger 2001-2017
   </metadata>
   <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)"
   fill="" stroke="none">
   <path d="M590 4383 l1 -738 756 -530 c698 -489 1151 -807 2618 -1837 l540
   -380 3 748 c2 590 -1 751 -10 760 -7 7 -308 218 -668 470 -360 251 -1230 859
   -1933 1351 -702 491 -1284 893 -1292 893 -13 0 -15 -92 -15 -737z"/>
   <path d="M3887 4708 l-597 -412 0 -381 0 -381 597 -419 c328 -231 602 -421
   610 -423 11 -3 13 204 13 1212 0 987 -2 1216 -13 1216 -7 0 -282 -186 -610
   -412z"/>
   <path d="M590 2135 c0 -910 3 -1225 11 -1225 10 0 343 231 1049 728 l155 109
   0 389 0 388 -595 418 c-327 229 -601 417 -607 418 -10 0 -13 -251 -13 -1225z"/>
   <path d="M590 320 l0 -310 1960 0 1960 0 0 310 0 310 -1960 0 -1960 0 0 -310z"/>
   </g>
   </svg>
</div>
      <span class="header-hidden">Navigate back to the homepage</span>
    </a>
    <div class="nav-controls">
      <button id="copyButton" class="icon-wrapper">
        <svg
    class="icon-image"
    width="24"
    height="20"
    viewBox="0 0 24 20"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
    >
    <path
      fillRule="evenodd"
      clipRule="evenodd"
      d="M2 5C2 3.34328 3.34328 2 5 2H14C15.6567 2 17 3.34328 17 5V9C17 10.6567 15.6567 12 14 12H10C9.44771 12 9 12.4477 9 13C9 13.5523 9.44771 14 10 14H14C16.7613 14 19 11.7613 19 9V5C19 2.23872 16.7613 0 14 0H5C2.23872 0 0 2.23872 0 5V9C0 10.4938 0.656313 11.8361 1.6935 12.7509C2.10768 13.1163 2.73961 13.0767 3.10494 12.6625C3.47028 12.2483 3.43068 11.6164 3.0165 11.2511C2.39169 10.6999 2 9.89621 2 9V5ZM7 11C7 9.34328 8.34328 8 10 8H14C14.5523 8 15 7.55228 15 7C15 6.44772 14.5523 6 14 6H10C7.23872 6 5 8.23872 5 11V15C5 17.7613 7.23872 20 10 20H19C21.7613 20 24 17.7613 24 15V11C24 9.50621 23.3437 8.16393 22.3065 7.24906C21.8923 6.88372 21.2604 6.92332 20.8951 7.3375C20.5297 7.75168 20.5693 8.38361 20.9835 8.74894C21.6083 9.30007 22 10.1038 22 11V15C22 16.6567 20.6567 18 19 18H10C8.34328 18 7 16.6567 7 15V11Z"
      fill="#000"
    />
</svg>
        <div id="toolTip" class="tool-tip " >
            copied
        </div>
        <input id="copyText" style="opacity: 0;" type="text" class="tool-tip " />
      </button>

      <button id="themeColorButton" class="icon-wrapper"> 
        <div id="sunRays" class="sun-rays"></div>
        <div id="moonOrSun" class="moon-or-sun"></div>
        <div id="moonMask" class="moon-mask"></div>
      </button>
    </div>
</div>
</Section>


<script src="/js/toggleLogos.js"></script>


<script src="/js/toggleColors.js"></script>


<script src="/js/copyUrl.js"></script>

        

<section class="section narrow">

    <section id="articleHero" class="section narrow">
    <div class="article-hero">
        <header class="article-header">
            <h1 class="article-hero-heading">山东省第二届数据应用创新创业大赛——疫情密切接触人员追踪</h1>
            <div class="article-hero-subtitle">
                <div class="article-meta">
                    


    <div class="article-coauthors-container">
        
        <span id="collapsedCoauthors" class="article-coauthors-collapsed">
            <div class="article-coauthors-list" style="width: 0px;">
                
            </div>
            <strong class="article-coauthors-name-container">
                
            </strong>
            <div class="article-coauthors-icon-container">
                <svg
width="17"
height="17"
viewBox="0 0 17 17"
fill="none"
xmlns="http://www.w3.org/2000/svg"
>
    <path style="fill: var(--primary);"
      d="M5.3209 8.86719L8.50026 12.0396L11.6796 8.86719L12.6563 9.84385L8.50026 13.9999L4.34424 9.84385L5.3209 8.86719Z"
    />
    <path style="fill: var(--primary);"
      d="M11.6791 8.13281L8.49974 4.96039L5.32039 8.13281L4.34373 7.15615L8.49974 3.00013L12.6558 7.15615L11.6791 8.13281Z"
    />
</svg>
            </div>
        </span>

        <ul id="uncollapsedCoauthors" class="article-coauthors-list-open hidden">
            <div id="uncollapsedAction" class="article-icon-open-container">
                <svg
width="17"
height="17"
viewBox="0 0 17 17"
fill="none"
xmlns="http://www.w3.org/2000/svg"
>
    <path style="fill: var(--primary);"
      d="M11.6796 14L8.50023 10.8276L5.32088 14L4.34422 13.0233L8.50023 8.86732L12.6563 13.0233L11.6796 14Z"
    />
    <path style="fill: var(--primary);"
      d="M5.32041 3L8.49977 6.17243L11.6791 3L12.6558 3.97666L8.49977 8.13268L4.34375 3.97666L5.32041 3Z"
    />
</svg>
            </div>
            
        </ul>
    </div>



<script src="/js/collapseAuthors.js"></script>
                    April 3, 2021
                    • 10 min read
                </div>
            </div>
        </header>
        
    </div>
</section>


    <aside id="progressBar" class="aside-container">
    <div class="aside-align">
      <div>
        <div class="overlap-container">
        </div>
      </div>
    </div>

    <div class="progress-container" tabIndex={-1}>
        <div class="track-line" aria-hidden="true">
            <div id="progressIndicator" class="progress-line"></div>
        </div>
    </div>
</aside>


    <article  id="articleContent" class="post-content" style="position:relative;">
        <p><img src="https://hexo-img-meurice.oss-cn-beijing.aliyuncs.com/cover/sdgov_2.png" alt="">
性能优化赛题，k-d树方案。初赛Rank28，复赛Rank16。</p>
<h2 id="赛题介绍">赛题介绍</h2>
<h3 id="赛题任务">赛题任务</h3>
<p>　　通过筛选个人基本信息、个人防疫信息、亮码位置、亮码时间等数据，判定直接密接人员，间接密接人员，判定疫情传播风险等级，辅助决策疫情防控力度。</p>
<h3 id="评分标准">评分标准</h3>
<p>　　准确率分数使用<strong>macro F1</strong>计算。</p>
<p>　　直接密接人员：与确诊患者亮码时间差的绝对值在5分钟内，距离在10米以内。<br>
　　间接密接人员：与直接密接人员的亮码时间差的绝对值在5分钟内，距离在10米以内。<br>
　　如果既是直接密接人员又是间接密接人员，统一归类为直接密接人员。</p>
<p>　　距离计算参考函数如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#f92672">from</span> math <span style="color:#f92672">import</span> radians, cos, sin, asin, sqrt
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">geodistance</span>(lng1, lat1, lng2, lat2):
</span></span><span style="display:flex;"><span>	lng1, lat1, lng2, lat2 <span style="color:#f92672">=</span> map(radians, [float(lng1), float(lat1), float(lng2), float(lat2)])
</span></span><span style="display:flex;"><span>    dlon <span style="color:#f92672">=</span> lng2<span style="color:#f92672">-</span>lng1
</span></span><span style="display:flex;"><span>    dlat <span style="color:#f92672">=</span> lat2<span style="color:#f92672">-</span>lat1
</span></span><span style="display:flex;"><span>    a <span style="color:#f92672">=</span> sin(dlat<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> cos(lat1) <span style="color:#f92672">*</span> cos(lat2) <span style="color:#f92672">*</span> sin(dlon<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    distance <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> asin(sqrt(a)) <span style="color:#f92672">*</span> <span style="color:#ae81ff">6371.393</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>    distance <span style="color:#f92672">=</span> round(distance, <span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> distance
</span></span></code></pre></div><h3 id="数据集描述">数据集描述</h3>
<p>　　<strong>个人轨迹数据（df_travel.csv）</strong>：<br>
　　id：String，人员唯一ID<br>
　　usetime：Date，亮码时间<br>
　　lng：Float，亮码位置经度（小数点5位，GCJ02坐标系）<br>
　　lat：Float，亮码位置纬度（小数点5位，GCJ02坐标系）</p>
<p>　　<strong>确诊患者亮码记录（confirm.csv）</strong>：<br>
　　亮码时间：Date，亮码时间；<br>
　　lng：Float，亮码位置经度（小数点5位，GCJ02坐标系）<br>
　　lat：Float，亮码位置纬度（小数点5位，GCJ02坐标系）<br>
　　备注：String，确诊患者的具体行为<br>
　　<em>只有一名确诊患者</em></p>
<h2 id="解决思路">解决思路</h2>
<p>　　整体上来看，方案比较常规，决赛还未开始，对于这题有没有一些特殊的方法，还需要等待答辩结束。  位于Rank5的江离重楼大佬在复赛结束后就分享了自己的代码和思路<br>
　　为每条轨迹记录添加唯一索引，先根据确诊人员信息和条件判断出直接密接的记录，根据这些记录筛选每个id在接触时间以后的所有记录，最后再根据这些记录和条件判断间接密接人员，<strong>先初筛，后细筛</strong>。</p>
<h3 id="直接密接人员">直接密接人员</h3>
<p>　　轨迹数据的规模为200万+条，确诊人员记录约为50条，规模并不大，所以直接考虑计算所有点对之间的Euclidean Distance / CityBlock Distance，筛选出亮码时间差在300秒以内以及经纬度距离在0.00025内的点对，再根据经纬度计算精确距离差，筛选出直接密接人员。<br>
　　在复赛阶段对这个方案又做了一些小优化，在线下环境成绩有所提升。由于确诊人员记录数量极少，所以根据这些点的经纬度及时间可以先大幅缩小搜索范围，即先使用集合运算挑选出处在可能范围内的人员轨迹记录，再做如上操作，代码如下。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gen_idx_direct</span>(candidate, target):
</span></span><span style="display:flex;"><span>    set_target_time <span style="color:#f92672">=</span> set([j <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> target<span style="color:#f92672">.</span>time <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(i <span style="color:#f92672">-</span> <span style="color:#ae81ff">300</span>,i <span style="color:#f92672">+</span> <span style="color:#ae81ff">301</span>)]) 
</span></span><span style="display:flex;"><span>    set_target_lng <span style="color:#f92672">=</span> set(np<span style="color:#f92672">.</span>around([j <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> target<span style="color:#f92672">.</span>lng <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> np<span style="color:#f92672">.</span>arange(i <span style="color:#f92672">-</span> <span style="color:#ae81ff">0.00025</span>,i <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.00025</span>,<span style="color:#ae81ff">0.00001</span>)], <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>    set_target_lat <span style="color:#f92672">=</span> set(np<span style="color:#f92672">.</span>around([j <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> target<span style="color:#f92672">.</span>lat <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> np<span style="color:#f92672">.</span>arange(i <span style="color:#f92672">-</span> <span style="color:#ae81ff">0.00025</span>,i <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.00025</span>,<span style="color:#ae81ff">0.00001</span>)], <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    candidate_ <span style="color:#f92672">=</span> candidate[(
</span></span><span style="display:flex;"><span>                    candidate<span style="color:#f92672">.</span>time<span style="color:#f92672">.</span>isin(list(set_target_time))) <span style="color:#f92672">&amp;</span> (
</span></span><span style="display:flex;"><span>                    np<span style="color:#f92672">.</span>round(candidate<span style="color:#f92672">.</span>lng, <span style="color:#ae81ff">5</span>)<span style="color:#f92672">.</span>isin(list(set_target_lng))) <span style="color:#f92672">&amp;</span> (
</span></span><span style="display:flex;"><span>                    np<span style="color:#f92672">.</span>round(candidate<span style="color:#f92672">.</span>lat, <span style="color:#ae81ff">5</span>)<span style="color:#f92672">.</span>isin(list(set_target_lat)))]<span style="color:#f92672">.</span>reset_index(drop<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    time_diff <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>where(
</span></span><span style="display:flex;"><span>                    abs(cdist(candidate_[[<span style="color:#e6db74">&#39;time&#39;</span>,<span style="color:#e6db74">&#39;temp&#39;</span>]],
</span></span><span style="display:flex;"><span>                        target[[<span style="color:#e6db74">&#39;time&#39;</span>,<span style="color:#e6db74">&#39;temp&#39;</span>]], metric<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;cityblock&#39;</span>)) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">300</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    distance <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>where(
</span></span><span style="display:flex;"><span>                    abs(cdist(candidate_[[<span style="color:#e6db74">&#39;lng&#39;</span>, <span style="color:#e6db74">&#39;lat&#39;</span>]],
</span></span><span style="display:flex;"><span>                        target[[<span style="color:#e6db74">&#39;lng&#39;</span>, <span style="color:#e6db74">&#39;lat&#39;</span>]])) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0.00025</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    result_mat <span style="color:#f92672">=</span> time_diff <span style="color:#f92672">*</span> distance
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    c_idx <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>where(result_mat <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    t_idx <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>where(result_mat <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>)[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    distance <span style="color:#f92672">=</span> geodistance(candidate_<span style="color:#f92672">.</span>iloc[c_idx, <span style="color:#ae81ff">3</span>],
</span></span><span style="display:flex;"><span>                           candidate_<span style="color:#f92672">.</span>iloc[c_idx, <span style="color:#ae81ff">2</span>],
</span></span><span style="display:flex;"><span>                           target<span style="color:#f92672">.</span>iloc[t_idx, <span style="color:#ae81ff">2</span>],
</span></span><span style="display:flex;"><span>                           target<span style="color:#f92672">.</span>iloc[t_idx, <span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    c_result <span style="color:#f92672">=</span> c_idx[np<span style="color:#f92672">.</span>where(distance <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">10</span>)[<span style="color:#ae81ff">0</span>]]
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># t_result = t_idx[np.where(distance &lt;= 10)[0]]</span>
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> candidate_<span style="color:#f92672">.</span>loc[list(set(c_result)), <span style="color:#e6db74">&#39;idx&#39;</span>]<span style="color:#f92672">.</span>tolist()
</span></span></code></pre></div><p>　　<strong>对距离计算函数进行了修改</strong>，使用numpy，改为矩阵并行计算。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numexpr <span style="color:#66d9ef">as</span> ne
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">geodistance</span>(lng1, lat1, lng2, lat2):
</span></span><span style="display:flex;"><span>    lng1 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>radians(np<span style="color:#f92672">.</span>array(lng1))
</span></span><span style="display:flex;"><span>    lat1 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>radians(np<span style="color:#f92672">.</span>array(lat1))
</span></span><span style="display:flex;"><span>    lng2 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>radians(np<span style="color:#f92672">.</span>array(lng2))
</span></span><span style="display:flex;"><span>    lat2 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>radians(np<span style="color:#f92672">.</span>array(lat2))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>round(ne<span style="color:#f92672">.</span>evaluate(<span style="color:#e6db74">&#34;2 * arcsin(sqrt(sin((lat2 - lat1) / 2) ** 2 + cos(lat1) * cos(lat2) * sin((lng2 - lng1) / 2) ** 2)) * 6371.393 * 1000&#34;</span>), <span style="color:#ae81ff">5</span>)
</span></span></code></pre></div><h3 id="间接密接人员">间接密接人员</h3>
<p>　　关于间接密接人员的搜索，尝试了两种方案，一种是使用KD树，另一种是将经纬度以一定的尺度网格化（0.0001），对于直接密接人员的记录，搜索其附近的九个格子。<br>
　　我所使用的是KD树的方案，然而比赛结束后看到Rank5 江离.重楼大佬在群里的分享，也是使用的网格化搜索的方案，不过语言方面使用的是C++，这才意识到针对计算密集型程序Python和C++巨大的效率差距，初赛阶段看到以Python作为入口语言，就默认用Python实现了，复赛阶段也一直没向这个方向进行优化，最后只排到了Rank16，这也是做这次比赛的遗憾之处吧~</p>
<h4 id="k-d-tree">K-D Tree</h4>
<p>　　Scipy中提供了KDTree的接口，scipy.spatial.cKDTree，其底层使用C语言实现，效率更高。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gen_idx_indirect_kd</span>(candidate, target):
</span></span><span style="display:flex;"><span>    candidate<span style="color:#f92672">.</span>reset_index(inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, drop<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    target<span style="color:#f92672">.</span>reset_index(inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, drop<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    kd_time_diff <span style="color:#f92672">=</span> cKDTree(candidate[[<span style="color:#e6db74">&#39;time&#39;</span>]])
</span></span><span style="display:flex;"><span>    time_diff_idx <span style="color:#f92672">=</span> kd_time_diff<span style="color:#f92672">.</span>query_ball_point(target[[<span style="color:#e6db74">&#39;time&#39;</span>]]<span style="color:#f92672">.</span>values<span style="color:#f92672">.</span>tolist(), r <span style="color:#f92672">=</span> <span style="color:#ae81ff">300</span>, p <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    kd_distance <span style="color:#f92672">=</span> cKDTree(candidate[[<span style="color:#e6db74">&#39;lng&#39;</span>,<span style="color:#e6db74">&#39;lat&#39;</span>]])
</span></span><span style="display:flex;"><span>    distance_idx <span style="color:#f92672">=</span> kd_distance<span style="color:#f92672">.</span>query_ball_point(target[[<span style="color:#e6db74">&#39;lng&#39;</span>,<span style="color:#e6db74">&#39;lat&#39;</span>]]<span style="color:#f92672">.</span>values<span style="color:#f92672">.</span>tolist(), r <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.00025</span>, p <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    intersection <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(distance_idx)):
</span></span><span style="display:flex;"><span>        intersection<span style="color:#f92672">.</span>append(list(set(distance_idx[i])<span style="color:#f92672">.</span>intersection(set(time_diff_idx[i]))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    c_idx <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    t_idx <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(intersection)):
</span></span><span style="display:flex;"><span>        c_idx<span style="color:#f92672">.</span>extend(intersection[i])
</span></span><span style="display:flex;"><span>        t_idx<span style="color:#f92672">.</span>extend([i] <span style="color:#f92672">*</span> len(intersection[i]))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    distance <span style="color:#f92672">=</span> geodistance(candidate<span style="color:#f92672">.</span>iloc[c_idx, <span style="color:#ae81ff">3</span>],
</span></span><span style="display:flex;"><span>                           candidate<span style="color:#f92672">.</span>iloc[c_idx, <span style="color:#ae81ff">2</span>],
</span></span><span style="display:flex;"><span>                           target<span style="color:#f92672">.</span>iloc[t_idx, <span style="color:#ae81ff">3</span>],
</span></span><span style="display:flex;"><span>                           target<span style="color:#f92672">.</span>iloc[t_idx, <span style="color:#ae81ff">2</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    c_result <span style="color:#f92672">=</span> [c_idx[i] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> (np<span style="color:#f92672">.</span>where((distance <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">10</span>))[<span style="color:#ae81ff">0</span>])<span style="color:#f92672">.</span>tolist()]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> candidate<span style="color:#f92672">.</span>iloc[list(set(c_result)), <span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>tolist()
</span></span></code></pre></div><h4 id="网格化搜索">网格化搜索</h4>
<p>　　网格化搜索实现起来相对比较简单，其思想类似于GeoHash，即将二位的经纬度坐标点映射到一维，但GeoHash在这里并不适合，一方面是效率过低，另一方面，和直接将经纬度点映射到0,1,&hellip;,n的效果相同。<br>
<img src="https://hexo-img-meurice.oss-cn-beijing.aliyuncs.com/ShanDongBD_covid/2095550-d86dc182d102451b.png" alt="GeoHash"></p>
<h2 id="关于效率">关于效率</h2>
<p>　　复赛结束时，线上成绩约为30s，并不算优秀。<br>
　　除计算外，I/O方面的优化也是本题的上分点之一。<br>
　　关于效率的计算，比较奇怪的是，线上评测成绩的抖动幅度似乎不小，我个人第一次和第二次提交的代码几乎相同，但线上成绩提升了近30%，除此之外，主办方所的线上环境只开放了CPU的一个核心，但经过实验，多进程对该题是work的，能带来大概25%的提升。但如果时间效率足够高的话，多进程显然就不太合适了，进程创建和切换所带来的开销已经不能忽略不计了。</p>
<h2 id="关于准确率">关于准确率</h2>
<p>　　初赛使用该方案的macro F1为1.0，但是对于复赛阶段的数据为0.999179，针对复赛的数据如何达到1.0还需要等决赛答辩后学习思路。<br>
　　补充：经验证，将密接的亮码时间判定从300秒改为310秒即可达到1.0的准确率，逻辑比较迷。<br>
　　不过这场比赛在密接的判定上确实比较模糊，有些复杂情况难以判定，主办方在一些问题上也没有给出明确的答复，需要多次尝试来进行验证。</p>
<h2 id="个人实现完整代码">个人实现完整代码</h2>
<p>　　<strong>由纯Python实现</strong>，和C/C++等语言的实现相比，时间效率并不算高，仅供参考。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Python" data-lang="Python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.spatial.distance <span style="color:#f92672">import</span> cdist
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> scipy.spatial <span style="color:#f92672">import</span> cKDTree
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numexpr <span style="color:#66d9ef">as</span> ne
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> multiprocessing
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">geodistance</span>(lng1, lat1, lng2, lat2):
</span></span><span style="display:flex;"><span>    lng1 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>radians(np<span style="color:#f92672">.</span>array(lng1))
</span></span><span style="display:flex;"><span>    lat1 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>radians(np<span style="color:#f92672">.</span>array(lat1))
</span></span><span style="display:flex;"><span>    lng2 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>radians(np<span style="color:#f92672">.</span>array(lng2))
</span></span><span style="display:flex;"><span>    lat2 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>radians(np<span style="color:#f92672">.</span>array(lat2))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>round(ne<span style="color:#f92672">.</span>evaluate(<span style="color:#e6db74">&#34;2 * arcsin(sqrt(sin((lat2 - lat1) / 2) ** 2 + cos(lat1) * cos(lat2) * sin((lng2 - lng1) / 2) ** 2)) * 6371.393 * 1000&#34;</span>), <span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gen_idx_direct</span>(candidate, target):
</span></span><span style="display:flex;"><span>    set_target_time <span style="color:#f92672">=</span> set([j <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> target<span style="color:#f92672">.</span>time <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(i <span style="color:#f92672">-</span> <span style="color:#ae81ff">300</span>,i <span style="color:#f92672">+</span> <span style="color:#ae81ff">301</span>)]) 
</span></span><span style="display:flex;"><span>    set_target_lng <span style="color:#f92672">=</span> set(np<span style="color:#f92672">.</span>around([j <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> target<span style="color:#f92672">.</span>lng <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> np<span style="color:#f92672">.</span>arange(i <span style="color:#f92672">-</span> <span style="color:#ae81ff">0.00025</span>,i <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.00025</span>,<span style="color:#ae81ff">0.00001</span>)], <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>    set_target_lat <span style="color:#f92672">=</span> set(np<span style="color:#f92672">.</span>around([j <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> target<span style="color:#f92672">.</span>lat <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> np<span style="color:#f92672">.</span>arange(i <span style="color:#f92672">-</span> <span style="color:#ae81ff">0.00025</span>,i <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.00025</span>,<span style="color:#ae81ff">0.00001</span>)], <span style="color:#ae81ff">5</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    candidate_ <span style="color:#f92672">=</span> candidate[(
</span></span><span style="display:flex;"><span>                    candidate<span style="color:#f92672">.</span>time<span style="color:#f92672">.</span>isin(list(set_target_time))) <span style="color:#f92672">&amp;</span> (
</span></span><span style="display:flex;"><span>                    np<span style="color:#f92672">.</span>round(candidate<span style="color:#f92672">.</span>lng, <span style="color:#ae81ff">5</span>)<span style="color:#f92672">.</span>isin(list(set_target_lng))) <span style="color:#f92672">&amp;</span> (
</span></span><span style="display:flex;"><span>                    np<span style="color:#f92672">.</span>round(candidate<span style="color:#f92672">.</span>lat, <span style="color:#ae81ff">5</span>)<span style="color:#f92672">.</span>isin(list(set_target_lat)))]<span style="color:#f92672">.</span>reset_index(drop<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    time_diff <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>where(
</span></span><span style="display:flex;"><span>                    abs(cdist(candidate_[[<span style="color:#e6db74">&#39;time&#39;</span>,<span style="color:#e6db74">&#39;temp&#39;</span>]],
</span></span><span style="display:flex;"><span>                        target[[<span style="color:#e6db74">&#39;time&#39;</span>,<span style="color:#e6db74">&#39;temp&#39;</span>]], metric<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;cityblock&#39;</span>)) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">300</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    distance <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>where(
</span></span><span style="display:flex;"><span>                    abs(cdist(candidate_[[<span style="color:#e6db74">&#39;lng&#39;</span>, <span style="color:#e6db74">&#39;lat&#39;</span>]],
</span></span><span style="display:flex;"><span>                        target[[<span style="color:#e6db74">&#39;lng&#39;</span>, <span style="color:#e6db74">&#39;lat&#39;</span>]])) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0.00025</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    result_mat <span style="color:#f92672">=</span> time_diff <span style="color:#f92672">*</span> distance
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    c_idx <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>where(result_mat <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    t_idx <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>where(result_mat <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>)[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    distance <span style="color:#f92672">=</span> geodistance(candidate_<span style="color:#f92672">.</span>iloc[c_idx, <span style="color:#ae81ff">3</span>],
</span></span><span style="display:flex;"><span>                           candidate_<span style="color:#f92672">.</span>iloc[c_idx, <span style="color:#ae81ff">2</span>],
</span></span><span style="display:flex;"><span>                           target<span style="color:#f92672">.</span>iloc[t_idx, <span style="color:#ae81ff">2</span>],
</span></span><span style="display:flex;"><span>                           target<span style="color:#f92672">.</span>iloc[t_idx, <span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    c_result <span style="color:#f92672">=</span> c_idx[np<span style="color:#f92672">.</span>where(distance <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">10</span>)[<span style="color:#ae81ff">0</span>]]
</span></span><span style="display:flex;"><span>    t_result <span style="color:#f92672">=</span> t_idx[np<span style="color:#f92672">.</span>where(distance <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">10</span>)[<span style="color:#ae81ff">0</span>]]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> candidate_<span style="color:#f92672">.</span>iloc[list(set(c_result)), <span style="color:#ae81ff">4</span>]<span style="color:#f92672">.</span>tolist(), pd<span style="color:#f92672">.</span>concat([candidate_<span style="color:#f92672">.</span>iloc[c_result,[<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">6</span>]]<span style="color:#f92672">.</span>reset_index(drop<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>), (target<span style="color:#f92672">.</span>iloc[t_result,<span style="color:#ae81ff">6</span>])<span style="color:#f92672">.</span>reset_index(drop<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)],axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>,ignore_index<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gen_idx_indirect_kd</span>(candidate, target):
</span></span><span style="display:flex;"><span>    candidate<span style="color:#f92672">.</span>reset_index(inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, drop<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    target<span style="color:#f92672">.</span>reset_index(inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, drop<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    kd_time_diff <span style="color:#f92672">=</span> cKDTree(candidate[[<span style="color:#e6db74">&#39;time&#39;</span>]])
</span></span><span style="display:flex;"><span>    time_diff_idx <span style="color:#f92672">=</span> kd_time_diff<span style="color:#f92672">.</span>query_ball_point(target[[<span style="color:#e6db74">&#39;time&#39;</span>]]<span style="color:#f92672">.</span>values<span style="color:#f92672">.</span>tolist(), r <span style="color:#f92672">=</span> <span style="color:#ae81ff">300</span>, p <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    kd_distance <span style="color:#f92672">=</span> cKDTree(candidate[[<span style="color:#e6db74">&#39;lng&#39;</span>,<span style="color:#e6db74">&#39;lat&#39;</span>]])
</span></span><span style="display:flex;"><span>    distance_idx <span style="color:#f92672">=</span> kd_distance<span style="color:#f92672">.</span>query_ball_point(target[[<span style="color:#e6db74">&#39;lng&#39;</span>,<span style="color:#e6db74">&#39;lat&#39;</span>]]<span style="color:#f92672">.</span>values<span style="color:#f92672">.</span>tolist(), r <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.00025</span>, p <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    intersection <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(distance_idx)):
</span></span><span style="display:flex;"><span>        intersection<span style="color:#f92672">.</span>append(list(set(distance_idx[i])<span style="color:#f92672">.</span>intersection(set(time_diff_idx[i]))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    c_idx <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    t_idx <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(intersection)):
</span></span><span style="display:flex;"><span>        c_idx<span style="color:#f92672">.</span>extend(intersection[i])
</span></span><span style="display:flex;"><span>        t_idx<span style="color:#f92672">.</span>extend([i] <span style="color:#f92672">*</span> len(intersection[i]))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    distance <span style="color:#f92672">=</span> geodistance(candidate<span style="color:#f92672">.</span>iloc[c_idx, <span style="color:#ae81ff">3</span>],
</span></span><span style="display:flex;"><span>                           candidate<span style="color:#f92672">.</span>iloc[c_idx, <span style="color:#ae81ff">2</span>],
</span></span><span style="display:flex;"><span>                           target<span style="color:#f92672">.</span>iloc[t_idx, <span style="color:#ae81ff">3</span>],
</span></span><span style="display:flex;"><span>                           target<span style="color:#f92672">.</span>iloc[t_idx, <span style="color:#ae81ff">2</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    c_result <span style="color:#f92672">=</span> [c_idx[i] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> (np<span style="color:#f92672">.</span>where((distance <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">10</span>))[<span style="color:#ae81ff">0</span>])<span style="color:#f92672">.</span>tolist()]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> candidate<span style="color:#f92672">.</span>iloc[list(set(c_result)), <span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>tolist()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>(dirname, savePath):
</span></span><span style="display:flex;"><span>    confirmPath <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(dirname, <span style="color:#e6db74">&#34;confirm.csv&#34;</span>)
</span></span><span style="display:flex;"><span>    travelPath <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(dirname, <span style="color:#e6db74">&#34;df_travel.csv&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    confirmed <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(confirmPath)
</span></span><span style="display:flex;"><span>    df_travel <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(travelPath)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    confirmed[<span style="color:#e6db74">&#39;亮码时间&#39;</span>] <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>to_datetime(confirmed[<span style="color:#e6db74">&#39;亮码时间&#39;</span>],format<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;%Y-%m-</span><span style="color:#e6db74">%d</span><span style="color:#e6db74"> %H:%M:%S&#39;</span>)
</span></span><span style="display:flex;"><span>    df_travel[<span style="color:#e6db74">&#39;usetime&#39;</span>] <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>to_datetime(df_travel[<span style="color:#e6db74">&#39;usetime&#39;</span>],format<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;%Y-%m-</span><span style="color:#e6db74">%d</span><span style="color:#e6db74"> %H:%M:%S&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    df_travel_length <span style="color:#f92672">=</span> len(df_travel)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    confirmed[<span style="color:#e6db74">&#39;idx&#39;</span>] <span style="color:#f92672">=</span> range(len(confirmed))
</span></span><span style="display:flex;"><span>    df_travel[<span style="color:#e6db74">&#39;idx&#39;</span>] <span style="color:#f92672">=</span> range(df_travel_length)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    confirmed[<span style="color:#e6db74">&#39;temp&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    df_travel[<span style="color:#e6db74">&#39;temp&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    confirmed[<span style="color:#e6db74">&#39;time&#39;</span>] <span style="color:#f92672">=</span> (pd<span style="color:#f92672">.</span>to_timedelta(confirmed[<span style="color:#e6db74">&#39;亮码时间&#39;</span>] <span style="color:#f92672">-</span> datetime(<span style="color:#ae81ff">2020</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">30</span>))<span style="color:#f92672">.</span>dt<span style="color:#f92672">.</span>total_seconds())<span style="color:#f92672">.</span>astype(int)
</span></span><span style="display:flex;"><span>    df_travel[<span style="color:#e6db74">&#39;time&#39;</span>] <span style="color:#f92672">=</span> (pd<span style="color:#f92672">.</span>to_timedelta(df_travel[<span style="color:#e6db74">&#39;usetime&#39;</span>] <span style="color:#f92672">-</span> datetime(<span style="color:#ae81ff">2020</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">30</span>))<span style="color:#f92672">.</span>dt<span style="color:#f92672">.</span>total_seconds())<span style="color:#f92672">.</span>astype(int)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    direct_idx, df_direct_min_time_ <span style="color:#f92672">=</span> gen_idx_direct(df_travel, confirmed)
</span></span><span style="display:flex;"><span>    df_direct_min_time_<span style="color:#f92672">.</span>columns <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;id&#39;</span>,<span style="color:#e6db74">&#39;ctime_direct&#39;</span>, <span style="color:#e6db74">&#39;ctime_confirm&#39;</span>]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    df_direct <span style="color:#f92672">=</span> df_travel[df_travel[<span style="color:#e6db74">&#39;idx&#39;</span>]<span style="color:#f92672">.</span>isin(direct_idx)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    df_travel <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>merge(df_travel, df_direct_min_time_<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#39;id&#39;</span>)<span style="color:#f92672">.</span>agg({<span style="color:#e6db74">&#39;ctime_direct&#39;</span>:min}), on<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;id&#39;</span>, how<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;left&#39;</span>)
</span></span><span style="display:flex;"><span>    df_travel<span style="color:#f92672">.</span>ctime_direct<span style="color:#f92672">.</span>fillna(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    df_travel[<span style="color:#e6db74">&#39;direct&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    df_travel<span style="color:#f92672">.</span>loc[(df_travel[<span style="color:#e6db74">&#39;time&#39;</span>] <span style="color:#f92672">&gt;=</span> df_travel[<span style="color:#e6db74">&#39;ctime_direct&#39;</span>]) <span style="color:#f92672">&amp;</span> (df_travel[<span style="color:#e6db74">&#39;ctime_direct&#39;</span>] <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>),<span style="color:#e6db74">&#39;direct&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    df_direct <span style="color:#f92672">=</span> df_travel[df_travel[<span style="color:#e6db74">&#39;direct&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#df_indirect_min_time = gen_idx_indirect_kd(df_travel[df_travel[&#39;direct&#39;] == 0], df_direct)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#indirect_id = df_indirect_min_time.id_i.tolist()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    p_i <span style="color:#f92672">=</span> multiprocessing<span style="color:#f92672">.</span>Pool(<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>    indirect_id_0 <span style="color:#f92672">=</span> p_i<span style="color:#f92672">.</span>apply_async(gen_idx_indirect_kd, args<span style="color:#f92672">=</span>(df_travel<span style="color:#f92672">.</span>iloc[np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">0</span>, df_travel_length, <span style="color:#ae81ff">3</span>)], df_direct))
</span></span><span style="display:flex;"><span>    indirect_id_1 <span style="color:#f92672">=</span> p_i<span style="color:#f92672">.</span>apply_async(gen_idx_indirect_kd, args<span style="color:#f92672">=</span>(df_travel<span style="color:#f92672">.</span>iloc[np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">1</span>, df_travel_length, <span style="color:#ae81ff">3</span>)], df_direct))
</span></span><span style="display:flex;"><span>    indirect_id_2 <span style="color:#f92672">=</span> p_i<span style="color:#f92672">.</span>apply_async(gen_idx_indirect_kd, args<span style="color:#f92672">=</span>(df_travel<span style="color:#f92672">.</span>iloc[np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">2</span>, df_travel_length, <span style="color:#ae81ff">3</span>)], df_direct))
</span></span><span style="display:flex;"><span>    p_i<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>    p_i<span style="color:#f92672">.</span>join()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    submission <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame({<span style="color:#e6db74">&#39;id&#39;</span>:list(set(df_travel[<span style="color:#e6db74">&#39;id&#39;</span>]<span style="color:#f92672">.</span>tolist())),<span style="color:#e6db74">&#39;label&#39;</span>:<span style="color:#ae81ff">0</span>})
</span></span><span style="display:flex;"><span>    submission<span style="color:#f92672">.</span>loc[submission[<span style="color:#e6db74">&#39;id&#39;</span>]<span style="color:#f92672">.</span>isin(list(set([i <span style="color:#66d9ef">for</span> l <span style="color:#f92672">in</span> [indirect_id_0<span style="color:#f92672">.</span>get(),indirect_id_1<span style="color:#f92672">.</span>get(),indirect_id_2<span style="color:#f92672">.</span>get()] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> l]))),<span style="color:#e6db74">&#39;label&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    submission<span style="color:#f92672">.</span>loc[submission[<span style="color:#e6db74">&#39;id&#39;</span>]<span style="color:#f92672">.</span>isin(df_direct[<span style="color:#e6db74">&#39;id&#39;</span>]<span style="color:#f92672">.</span>tolist()),<span style="color:#e6db74">&#39;label&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    submission<span style="color:#f92672">.</span>to_csv(savePath,index<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    dirname <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>]  <span style="color:#75715e"># 所需预测的文件夹</span>
</span></span><span style="display:flex;"><span>    savePath <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">2</span>]  <span style="color:#75715e"># 预测结果保存文件</span>
</span></span><span style="display:flex;"><span>    main(dirname, savePath)
</span></span></code></pre></div><h2 id="rank5实现江离重楼">Rank5实现（江离.重楼）</h2>
<p>　　转自群聊。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;cstdio&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;cmath&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;algorithm&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;sys/mman.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;unistd.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;fcntl.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;cstring&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define MAX 15000005
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> std;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">double</span> <span style="color:#a6e22e">radians</span>(<span style="color:#66d9ef">double</span> a) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> a <span style="color:#f92672">/</span> <span style="color:#ae81ff">180.0</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">3.141592653589793</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">double</span> <span style="color:#a6e22e">sqr</span>(<span style="color:#66d9ef">double</span> a) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> a <span style="color:#f92672">*</span> a;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> touchCnt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">MyHashSet</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Node</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">long</span> <span style="color:#66d9ef">long</span> value;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> nxt;
</span></span><span style="display:flex;"><span>    } myHash[MAX];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> MOD <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">19</span>) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> myHashCnt <span style="color:#f92672">=</span> MOD <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">insert</span>(<span style="color:#66d9ef">long</span> <span style="color:#66d9ef">long</span> value) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> now <span style="color:#f92672">=</span> (value <span style="color:#f92672">&amp;</span> MOD);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (myHash[now].nxt) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (myHash[now].value <span style="color:#f92672">==</span> value) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            now <span style="color:#f92672">=</span> myHash[now].nxt;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        myHash[now].value <span style="color:#f92672">=</span> value;
</span></span><span style="display:flex;"><span>        myHash[now].nxt <span style="color:#f92672">=</span> myHashCnt<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">has</span>(<span style="color:#66d9ef">long</span> <span style="color:#66d9ef">long</span> value) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> now <span style="color:#f92672">=</span> (value <span style="color:#f92672">&amp;</span> MOD);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (myHash[now].nxt) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (myHash[now].value <span style="color:#f92672">==</span> value) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> true;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            now <span style="color:#f92672">=</span> myHash[now].nxt;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> false;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>} idHashSet;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">MyHashMap</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Node</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">long</span> <span style="color:#66d9ef">long</span> value;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> realValue;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> nxt;
</span></span><span style="display:flex;"><span>    } myHash[MAX];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> MOD <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">16</span>) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> myHashCnt <span style="color:#f92672">=</span> MOD <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">insert</span>(<span style="color:#66d9ef">long</span> <span style="color:#66d9ef">long</span> value, <span style="color:#66d9ef">int</span> realValue) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> now <span style="color:#f92672">=</span> (value <span style="color:#f92672">&amp;</span> MOD);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (myHash[now].nxt) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (myHash[now].value <span style="color:#f92672">==</span> value) {
</span></span><span style="display:flex;"><span>                myHash[now].realValue <span style="color:#f92672">=</span> realValue;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            now <span style="color:#f92672">=</span> myHash[now].nxt;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        myHash[now].realValue <span style="color:#f92672">=</span> realValue;
</span></span><span style="display:flex;"><span>        myHash[now].value <span style="color:#f92672">=</span> value;
</span></span><span style="display:flex;"><span>        myHash[now].nxt <span style="color:#f92672">=</span> myHashCnt<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">find</span>(<span style="color:#66d9ef">long</span> <span style="color:#66d9ef">long</span> value) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> now <span style="color:#f92672">=</span> (value <span style="color:#f92672">&amp;</span> MOD);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (myHash[now].nxt) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (myHash[now].value <span style="color:#f92672">==</span> value) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> myHash[now].realValue;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            now <span style="color:#f92672">=</span> myHash[now].nxt;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>} startTime, level;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Record</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>pos;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">long</span> <span style="color:#66d9ef">long</span> idHash <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> time;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> lat, lng;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">bool</span> isxg <span style="color:#f92672">=</span> false;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">bool</span> <span style="color:#66d9ef">operator</span> <span style="color:#f92672">&lt;</span> (<span style="color:#66d9ef">const</span> Record <span style="color:#f92672">&amp;</span>b) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> time <span style="color:#f92672">&lt;</span> b.time;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">IsTouch</span>(<span style="color:#66d9ef">const</span> Record <span style="color:#f92672">&amp;</span>b) {
</span></span><span style="display:flex;"><span>        touchCnt<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (abs(lng <span style="color:#f92672">-</span> b.lng) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">50</span> <span style="color:#f92672">||</span> fabs(lat <span style="color:#f92672">-</span> b.lat) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">50</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> false;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> lng1 <span style="color:#f92672">=</span> radians((<span style="color:#66d9ef">double</span>)lng <span style="color:#f92672">/</span> <span style="color:#ae81ff">100000</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> lat1 <span style="color:#f92672">=</span> radians((<span style="color:#66d9ef">double</span>)lat <span style="color:#f92672">/</span> <span style="color:#ae81ff">100000</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> lng2 <span style="color:#f92672">=</span> radians((<span style="color:#66d9ef">double</span>)b.lng <span style="color:#f92672">/</span> <span style="color:#ae81ff">100000</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> lat2 <span style="color:#f92672">=</span> radians((<span style="color:#66d9ef">double</span>)b.lat <span style="color:#f92672">/</span> <span style="color:#ae81ff">100000</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> dlon <span style="color:#f92672">=</span> lng2 <span style="color:#f92672">-</span> lng1;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> dlat <span style="color:#f92672">=</span> lat2 <span style="color:#f92672">-</span> lat1;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> a <span style="color:#f92672">=</span> sqr(sin(dlat <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>))  <span style="color:#f92672">+</span> cos(lat1) <span style="color:#f92672">*</span> cos(lat2) <span style="color:#f92672">*</span> sqr(sin(dlon <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> distance <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> asin(sqrt(a)) <span style="color:#f92672">*</span> <span style="color:#ae81ff">6371.393</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> distance <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1e-9</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> <span style="color:#a6e22e">getDist</span>(<span style="color:#66d9ef">const</span> Record <span style="color:#f92672">&amp;</span>b) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> lng1 <span style="color:#f92672">=</span> radians((<span style="color:#66d9ef">double</span>)lng <span style="color:#f92672">/</span> <span style="color:#ae81ff">100000</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> lat1 <span style="color:#f92672">=</span> radians((<span style="color:#66d9ef">double</span>)lat <span style="color:#f92672">/</span> <span style="color:#ae81ff">100000</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> lng2 <span style="color:#f92672">=</span> radians((<span style="color:#66d9ef">double</span>)b.lng <span style="color:#f92672">/</span> <span style="color:#ae81ff">100000</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> lat2 <span style="color:#f92672">=</span> radians((<span style="color:#66d9ef">double</span>)b.lat <span style="color:#f92672">/</span> <span style="color:#ae81ff">100000</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> dlon <span style="color:#f92672">=</span> lng2 <span style="color:#f92672">-</span> lng1;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> dlat <span style="color:#f92672">=</span> lat2 <span style="color:#f92672">-</span> lat1;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> a <span style="color:#f92672">=</span> sqr(sin(dlat <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>))  <span style="color:#f92672">+</span> cos(lat1) <span style="color:#f92672">*</span> cos(lat2) <span style="color:#f92672">*</span> sqr(sin(dlon <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> distance <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> asin(sqrt(a)) <span style="color:#f92672">*</span> <span style="color:#ae81ff">6371.393</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> distance;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">MyBucket</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Node</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> x, y;
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    Node nodes[MAX];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> cnt <span style="color:#f92672">=</span> <span style="color:#ae81ff">2000000</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">insert</span>(<span style="color:#66d9ef">int</span> key, <span style="color:#66d9ef">int</span> id) {
</span></span><span style="display:flex;"><span>        cnt<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        nodes[cnt].x <span style="color:#f92672">=</span> id;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (nodes[key].x <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>            nodes[key].x <span style="color:#f92672">=</span> nodes[key].y <span style="color:#f92672">=</span> cnt;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            nodes[nodes[key].y].y <span style="color:#f92672">=</span> cnt;
</span></span><span style="display:flex;"><span>            nodes[key].y <span style="color:#f92672">=</span> cnt;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">pop</span>(<span style="color:#66d9ef">int</span> key) {
</span></span><span style="display:flex;"><span>        nodes[key].x <span style="color:#f92672">=</span> nodes[nodes[key].x].y;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>} <span style="color:#75715e">/*latids, lngids*/</span> ids;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Record temp[MAX], records[MAX];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> recordSize <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> MAXY <span style="color:#f92672">=</span> <span style="color:#ae81ff">3000</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> days[MAXY][<span style="color:#ae81ff">15</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">InitDays</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> cur <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> y <span style="color:#f92672">=</span> <span style="color:#ae81ff">2000</span>; y <span style="color:#f92672">&lt;</span> MAXY; y<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> m <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; m <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">12</span>; m<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            days[y][m] <span style="color:#f92672">=</span> cur;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (m <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">||</span> m <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">||</span> m <span style="color:#f92672">==</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">||</span> m <span style="color:#f92672">==</span> <span style="color:#ae81ff">7</span> <span style="color:#f92672">||</span> m <span style="color:#f92672">==</span> <span style="color:#ae81ff">8</span> <span style="color:#f92672">||</span> m <span style="color:#f92672">==</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">||</span> m <span style="color:#f92672">==</span> <span style="color:#ae81ff">12</span>) {
</span></span><span style="display:flex;"><span>                cur <span style="color:#f92672">+=</span> <span style="color:#ae81ff">31</span>;
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (m <span style="color:#f92672">==</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">||</span> m <span style="color:#f92672">==</span> <span style="color:#ae81ff">6</span> <span style="color:#f92672">||</span> m <span style="color:#f92672">==</span> <span style="color:#ae81ff">9</span> <span style="color:#f92672">||</span> m <span style="color:#f92672">==</span> <span style="color:#ae81ff">11</span>) {
</span></span><span style="display:flex;"><span>                cur <span style="color:#f92672">+=</span> <span style="color:#ae81ff">30</span>;
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> ((y <span style="color:#f92672">%</span> <span style="color:#ae81ff">100</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> y <span style="color:#f92672">%</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) <span style="color:#f92672">||</span> (y <span style="color:#f92672">%</span> <span style="color:#ae81ff">400</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)) {
</span></span><span style="display:flex;"><span>                    cur <span style="color:#f92672">+=</span> <span style="color:#ae81ff">29</span>;
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                    cur <span style="color:#f92672">+=</span> <span style="color:#ae81ff">28</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">gettime</span>(<span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">tm</span> <span style="color:#f92672">&amp;</span>tm) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (((days[tm.tm_year][tm.tm_mon] <span style="color:#f92672">+</span> tm.tm_mday) <span style="color:#f92672">*</span> <span style="color:#ae81ff">24</span> <span style="color:#f92672">+</span> tm.tm_hour) <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span> <span style="color:#f92672">+</span> tm.tm_min) <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span> <span style="color:#f92672">+</span> tm.tm_sec;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>buffer;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ReadRecords</span>(Record<span style="color:#f92672">*</span> records, Record <span style="color:#f92672">*</span>result, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>recordFile, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>travelFile) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> sst <span style="color:#f92672">=</span> clock();
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//records.clear();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/*Record cur;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    FILE *fi = fopen(&#34;../data/record&#34;, &#34;r&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    while (cur.ReadRecord(fi)) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        records.push_back(cur);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    fclose(fi);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    fi = fopen(&#34;../data/travel&#34;, &#34;r&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    while (cur.ReadTravel(fi)) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        records.push_back(cur);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        level[cur.id] = 0;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    fclose(fi);*/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/*FILE *fi = fopen(recordFile, &#34;rb&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    fseek(fi, 0L, SEEK_END);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    int len = ftell(fi);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    fseek(fi, 0L, SEEK_SET);*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//buffer = new char[len];
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//int ret = fread(buffer, sizeof(char), len, fi);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> fd <span style="color:#f92672">=</span> open(recordFile, O_RDONLY);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> len <span style="color:#f92672">=</span> lseek(fd, <span style="color:#ae81ff">0</span>, SEEK_END);
</span></span><span style="display:flex;"><span>    buffer <span style="color:#f92672">=</span> (<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>) mmap( NULL,  len ,PROT_READ, MAP_PRIVATE, fd, <span style="color:#ae81ff">0</span> );
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>pos <span style="color:#f92672">=</span> buffer;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>end <span style="color:#f92672">=</span> buffer <span style="color:#f92672">+</span> len;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (<span style="color:#f92672">*</span>pos <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;\n&#39;</span>) {
</span></span><span style="display:flex;"><span>        pos<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    pos<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> minTime <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">30</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> maxTime <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (pos <span style="color:#f92672">&lt;</span> end) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">auto</span> <span style="color:#f92672">&amp;</span>record <span style="color:#f92672">=</span> records[recordSize<span style="color:#f92672">++</span>];
</span></span><span style="display:flex;"><span>        record.isxg <span style="color:#f92672">=</span> true;
</span></span><span style="display:flex;"><span>        record.time <span style="color:#f92672">=</span> (((days[(pos[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span> <span style="color:#f92672">+</span> (pos[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span> <span style="color:#f92672">+</span> (pos[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> pos[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>][(pos[<span style="color:#ae81ff">5</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> pos[<span style="color:#ae81ff">6</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>]
</span></span><span style="display:flex;"><span>                         <span style="color:#f92672">+</span> ((pos[<span style="color:#ae81ff">8</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> pos[<span style="color:#ae81ff">9</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>)) <span style="color:#f92672">*</span> <span style="color:#ae81ff">24</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>                ((pos[<span style="color:#ae81ff">11</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> pos[<span style="color:#ae81ff">12</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>)) <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span> <span style="color:#f92672">+</span> ((pos[<span style="color:#ae81ff">14</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> pos[<span style="color:#ae81ff">15</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>)) <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span> <span style="color:#f92672">+</span> ((pos[<span style="color:#ae81ff">17</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> pos[<span style="color:#ae81ff">18</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>);
</span></span><span style="display:flex;"><span>        minTime <span style="color:#f92672">=</span> min(minTime, record.time);
</span></span><span style="display:flex;"><span>        maxTime <span style="color:#f92672">=</span> max(maxTime, record.time);
</span></span><span style="display:flex;"><span>        pos <span style="color:#f92672">+=</span> <span style="color:#ae81ff">20</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (<span style="color:#f92672">*</span>pos <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;.&#39;</span>) {
</span></span><span style="display:flex;"><span>            (record.lat <span style="color:#f92672">*=</span> <span style="color:#ae81ff">10</span>) <span style="color:#f92672">+=</span> ((<span style="color:#f92672">*</span>pos<span style="color:#f92672">++</span>) <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        pos<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> fz <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, fm <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (<span style="color:#f92672">*</span>pos <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;,&#39;</span> <span style="color:#f92672">&amp;&amp;</span> fm <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">100000</span>) {
</span></span><span style="display:flex;"><span>            (fz <span style="color:#f92672">*=</span> <span style="color:#ae81ff">10</span>) <span style="color:#f92672">+=</span> ((<span style="color:#f92672">*</span>pos<span style="color:#f92672">++</span>) <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>);
</span></span><span style="display:flex;"><span>            fm <span style="color:#f92672">*=</span> <span style="color:#ae81ff">10</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">*</span>pos <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;,&#39;</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> ((<span style="color:#f92672">*</span>pos) <span style="color:#f92672">&gt;=</span> <span style="color:#e6db74">&#39;5&#39;</span>) {
</span></span><span style="display:flex;"><span>                fz<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (<span style="color:#f92672">*</span>pos <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;,&#39;</span>) {
</span></span><span style="display:flex;"><span>                pos<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        (record.lat <span style="color:#f92672">*=</span> <span style="color:#ae81ff">100000</span>) <span style="color:#f92672">+=</span> (fz <span style="color:#f92672">*</span> (<span style="color:#ae81ff">100000</span> <span style="color:#f92672">/</span> fm));
</span></span><span style="display:flex;"><span>        pos<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (<span style="color:#f92672">*</span>pos <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;.&#39;</span>) {
</span></span><span style="display:flex;"><span>            (record.lng <span style="color:#f92672">*=</span> <span style="color:#ae81ff">10</span>) <span style="color:#f92672">+=</span> ((<span style="color:#f92672">*</span>pos<span style="color:#f92672">++</span>) <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        pos<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        fz <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, fm <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (<span style="color:#f92672">*</span>pos <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;,&#39;</span> <span style="color:#f92672">&amp;&amp;</span> fm <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">100000</span>) {
</span></span><span style="display:flex;"><span>            (fz <span style="color:#f92672">*=</span> <span style="color:#ae81ff">10</span>) <span style="color:#f92672">+=</span> ((<span style="color:#f92672">*</span>pos<span style="color:#f92672">++</span>) <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>);
</span></span><span style="display:flex;"><span>            fm <span style="color:#f92672">*=</span> <span style="color:#ae81ff">10</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">*</span>pos <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;,&#39;</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> ((<span style="color:#f92672">*</span>pos) <span style="color:#f92672">&gt;=</span> <span style="color:#e6db74">&#39;5&#39;</span>) {
</span></span><span style="display:flex;"><span>                fz<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (<span style="color:#f92672">*</span>pos <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;,&#39;</span>) {
</span></span><span style="display:flex;"><span>                pos<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        (record.lng <span style="color:#f92672">*=</span> <span style="color:#ae81ff">100000</span>) <span style="color:#f92672">+=</span> (fz <span style="color:#f92672">*</span> (<span style="color:#ae81ff">100000</span> <span style="color:#f92672">/</span> fm));
</span></span><span style="display:flex;"><span>        pos<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (<span style="color:#f92672">*</span>pos <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;\n&#39;</span> <span style="color:#f92672">&amp;&amp;</span> pos <span style="color:#f92672">&lt;</span> end) {
</span></span><span style="display:flex;"><span>            pos<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        pos<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//delete[] buffer;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">/*fclose(fi);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    fi = fopen(travelFile, &#34;rb&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    fseek(fi, 0L, SEEK_END);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    len = ftell(fi);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    fseek(fi, 0L, SEEK_SET);*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//buffer = new char[len];
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//ret = fread(buffer, sizeof(char), len, fi);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    fd <span style="color:#f92672">=</span> open(travelFile, O_RDONLY);
</span></span><span style="display:flex;"><span>    len <span style="color:#f92672">=</span> lseek(fd, <span style="color:#ae81ff">0</span>, SEEK_END);
</span></span><span style="display:flex;"><span>    posix_fadvise(fd, <span style="color:#ae81ff">0</span>, len, POSIX_FADV_SEQUENTIAL);
</span></span><span style="display:flex;"><span>    buffer <span style="color:#f92672">=</span> (<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>) mmap( NULL,  len ,PROT_READ, MAP_PRIVATE, fd, <span style="color:#ae81ff">0</span> );
</span></span><span style="display:flex;"><span>    pos <span style="color:#f92672">=</span> buffer;
</span></span><span style="display:flex;"><span>    end <span style="color:#f92672">=</span> buffer <span style="color:#f92672">+</span> len;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (<span style="color:#f92672">*</span>pos <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;\n&#39;</span>) {
</span></span><span style="display:flex;"><span>        pos<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    pos<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    printf(<span style="color:#e6db74">&#34;read spend %f s.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, (<span style="color:#66d9ef">double</span>)(clock() <span style="color:#f92672">-</span> sst) <span style="color:#f92672">/</span> CLOCKS_PER_SEC);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (pos <span style="color:#f92672">&lt;</span> end) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">auto</span> <span style="color:#f92672">&amp;</span>record <span style="color:#f92672">=</span> records[recordSize<span style="color:#f92672">++</span>];
</span></span><span style="display:flex;"><span>        record.isxg <span style="color:#f92672">=</span> false;
</span></span><span style="display:flex;"><span>        record.pos <span style="color:#f92672">=</span> pos;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (<span style="color:#f92672">*</span>pos <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;,&#39;</span>) {
</span></span><span style="display:flex;"><span>            (record.idHash <span style="color:#f92672">*=</span> <span style="color:#ae81ff">13131</span>) <span style="color:#f92672">+=</span> <span style="color:#f92672">*</span>(pos<span style="color:#f92672">++</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        pos<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        record.time <span style="color:#f92672">=</span> (((days[(pos[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span> <span style="color:#f92672">+</span> (pos[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span> <span style="color:#f92672">+</span> (pos[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> pos[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>][(pos[<span style="color:#ae81ff">5</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> pos[<span style="color:#ae81ff">6</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>]
</span></span><span style="display:flex;"><span>                         <span style="color:#f92672">+</span> ((pos[<span style="color:#ae81ff">8</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> pos[<span style="color:#ae81ff">9</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>)) <span style="color:#f92672">*</span> <span style="color:#ae81ff">24</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>                        ((pos[<span style="color:#ae81ff">11</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> pos[<span style="color:#ae81ff">12</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>)) <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span> <span style="color:#f92672">+</span> ((pos[<span style="color:#ae81ff">14</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> pos[<span style="color:#ae81ff">15</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>)) <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span> <span style="color:#f92672">+</span> ((pos[<span style="color:#ae81ff">17</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">+</span> pos[<span style="color:#ae81ff">18</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>);
</span></span><span style="display:flex;"><span>        minTime <span style="color:#f92672">=</span> min(minTime, record.time);
</span></span><span style="display:flex;"><span>        maxTime <span style="color:#f92672">=</span> max(maxTime, record.time);
</span></span><span style="display:flex;"><span>        pos <span style="color:#f92672">+=</span> <span style="color:#ae81ff">20</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (<span style="color:#f92672">*</span>pos <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;.&#39;</span>) {
</span></span><span style="display:flex;"><span>            (record.lat <span style="color:#f92672">*=</span> <span style="color:#ae81ff">10</span>) <span style="color:#f92672">+=</span> ((<span style="color:#f92672">*</span>pos<span style="color:#f92672">++</span>) <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        pos<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> fz <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, fm <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (<span style="color:#f92672">*</span>pos <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;,&#39;</span> <span style="color:#f92672">&amp;&amp;</span> fm <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">100000</span>) {
</span></span><span style="display:flex;"><span>            (fz <span style="color:#f92672">*=</span> <span style="color:#ae81ff">10</span>) <span style="color:#f92672">+=</span> ((<span style="color:#f92672">*</span>pos<span style="color:#f92672">++</span>) <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>);
</span></span><span style="display:flex;"><span>            fm <span style="color:#f92672">*=</span> <span style="color:#ae81ff">10</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">*</span>pos <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;,&#39;</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> ((<span style="color:#f92672">*</span>pos) <span style="color:#f92672">&gt;=</span> <span style="color:#e6db74">&#39;5&#39;</span>) {
</span></span><span style="display:flex;"><span>                fz<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (<span style="color:#f92672">*</span>pos <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;,&#39;</span>) {
</span></span><span style="display:flex;"><span>                pos<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        (record.lat <span style="color:#f92672">*=</span> <span style="color:#ae81ff">100000</span>) <span style="color:#f92672">+=</span> (fz <span style="color:#f92672">*</span> (<span style="color:#ae81ff">100000</span> <span style="color:#f92672">/</span> fm));
</span></span><span style="display:flex;"><span>        pos<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (<span style="color:#f92672">*</span>pos <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;.&#39;</span>) {
</span></span><span style="display:flex;"><span>            (record.lng <span style="color:#f92672">*=</span> <span style="color:#ae81ff">10</span>) <span style="color:#f92672">+=</span> ((<span style="color:#f92672">*</span>pos<span style="color:#f92672">++</span>) <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        pos<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        fz <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, fm <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (<span style="color:#f92672">*</span>pos <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;\n&#39;</span> <span style="color:#f92672">&amp;&amp;</span> pos <span style="color:#f92672">&lt;</span> end <span style="color:#f92672">&amp;&amp;</span> fm <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">100000</span>) {
</span></span><span style="display:flex;"><span>            (fz <span style="color:#f92672">*=</span> <span style="color:#ae81ff">10</span>) <span style="color:#f92672">+=</span> ((<span style="color:#f92672">*</span>pos<span style="color:#f92672">++</span>) <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;0&#39;</span>);
</span></span><span style="display:flex;"><span>            fm <span style="color:#f92672">*=</span> <span style="color:#ae81ff">10</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">*</span>pos <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;,&#39;</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> ((<span style="color:#f92672">*</span>pos) <span style="color:#f92672">&gt;=</span> <span style="color:#e6db74">&#39;5&#39;</span>) {
</span></span><span style="display:flex;"><span>                fz<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (<span style="color:#f92672">*</span>pos <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;\n&#39;</span> <span style="color:#f92672">&amp;&amp;</span> pos <span style="color:#f92672">&lt;</span> end) {
</span></span><span style="display:flex;"><span>                pos<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        (record.lng <span style="color:#f92672">*=</span> <span style="color:#ae81ff">100000</span>) <span style="color:#f92672">+=</span> (fz <span style="color:#f92672">*</span> (<span style="color:#ae81ff">100000</span> <span style="color:#f92672">/</span> fm));
</span></span><span style="display:flex;"><span>        pos<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//fclose(fi);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    printf(<span style="color:#e6db74">&#34;read all spend %f s.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, (<span style="color:#66d9ef">double</span>)(clock() <span style="color:#f92672">-</span> sst) <span style="color:#f92672">/</span> CLOCKS_PER_SEC);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/*maxTime -= minTime;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    int *sum = new int[maxTime + 1];
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    memset(sum, 0, sizeof(int) * (maxTime + 1));
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    for (int i = 0; i &lt; recordSize; i++) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        sum[records[i].time - minTime]++;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    for (int i = 1; i &lt;= maxTime; i++) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        sum[i] += sum[i - 1];
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    for (int i = 0; i &lt; recordSize; i++) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        result[--sum[records[i].time - minTime]] = records[i];
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    }*/</span>
</span></span><span style="display:flex;"><span>    sort(records, records <span style="color:#f92672">+</span> recordSize);
</span></span><span style="display:flex;"><span>    printf(<span style="color:#e6db74">&#34;finish all spend %f s.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, (<span style="color:#66d9ef">double</span>)(clock() <span style="color:#f92672">-</span> sst) <span style="color:#f92672">/</span> CLOCKS_PER_SEC);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">extern</span> <span style="color:#e6db74">&#34;C&#34;</span> {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">work</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>recordFile, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>travelFile, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>outputFile) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> st <span style="color:#f92672">=</span> clock();
</span></span><span style="display:flex;"><span>    InitDays();
</span></span><span style="display:flex;"><span>    ReadRecords(records, temp, recordFile, travelFile);
</span></span><span style="display:flex;"><span>    printf(<span style="color:#e6db74">&#34;finish read at %f s.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, (<span style="color:#66d9ef">double</span>) (clock() <span style="color:#f92672">-</span> st) <span style="color:#f92672">/</span> CLOCKS_PER_SEC);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> recordSize; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (records[i].isxg) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">auto</span> <span style="color:#f92672">&amp;</span>cur <span style="color:#f92672">=</span> records[i];
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> st <span style="color:#f92672">=</span> i;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (st <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> cur.time <span style="color:#f92672">-</span> records[st <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>].time <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">300</span>) {
</span></span><span style="display:flex;"><span>                st<span style="color:#f92672">--</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> st; j <span style="color:#f92672">&lt;</span> recordSize <span style="color:#f92672">&amp;&amp;</span> records[j].time <span style="color:#f92672">-</span> cur.time <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">300</span>; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>records[j].isxg <span style="color:#f92672">&amp;&amp;</span> cur.IsTouch(records[j])) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">long</span> <span style="color:#66d9ef">long</span> h <span style="color:#f92672">=</span> records[j].idHash;
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">int</span> f <span style="color:#f92672">=</span> startTime.find(h);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (startTime.find(h) <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>                        startTime.insert(h, records[j].time);
</span></span><span style="display:flex;"><span>                        level.insert(h, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>                    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (records[j].time <span style="color:#f92672">&lt;</span> f) {
</span></span><span style="display:flex;"><span>                        startTime.insert(h, records[j].time);
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    printf(<span style="color:#e6db74">&#34;finish phase1 at %f s.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, (<span style="color:#66d9ef">double</span>) (clock() <span style="color:#f92672">-</span> st) <span style="color:#f92672">/</span> CLOCKS_PER_SEC);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> l <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, r <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> idCnt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> recordSize; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>records[i].isxg <span style="color:#f92672">&amp;&amp;</span> startTime.find(records[i].idHash) <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> timeNow <span style="color:#f92672">=</span> records[i].time;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (r <span style="color:#f92672">&lt;</span> recordSize <span style="color:#f92672">&amp;&amp;</span> timeNow <span style="color:#f92672">+</span> <span style="color:#ae81ff">300</span> <span style="color:#f92672">&gt;=</span> records[r].time) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">int</span> it <span style="color:#f92672">=</span> startTime.find(records[r].idHash);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (it <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;&amp;</span> records[r].time <span style="color:#f92672">&gt;=</span> it) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">//latids.insert(records[r].lat / 100, r);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#75715e">//lngids.insert(records[r].lng / 100, r);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    ids.insert((records[r].lat <span style="color:#f92672">/</span> <span style="color:#ae81ff">50</span> <span style="color:#f92672">+</span> records[r].lng <span style="color:#f92672">/</span> <span style="color:#ae81ff">50</span>), r);
</span></span><span style="display:flex;"><span>                    idCnt<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                r<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (l <span style="color:#f92672">&lt;</span> r <span style="color:#f92672">&amp;&amp;</span> records[l].time <span style="color:#f92672">+</span> <span style="color:#ae81ff">300</span> <span style="color:#f92672">&lt;</span> timeNow) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">int</span> it <span style="color:#f92672">=</span> startTime.find(records[l].idHash);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (it <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;&amp;</span> records[l].time <span style="color:#f92672">&gt;=</span> it) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">//latids.pop(records[l].lat / 100);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#75715e">//lngids.pop(records[l].lng / 100);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    ids.pop((records[l].lat <span style="color:#f92672">/</span> <span style="color:#ae81ff">50</span> <span style="color:#f92672">+</span> records[l].lng <span style="color:#f92672">/</span> <span style="color:#ae81ff">50</span>));
</span></span><span style="display:flex;"><span>                    idCnt<span style="color:#f92672">--</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                l<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (idCnt <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">auto</span> <span style="color:#f92672">&amp;</span>cur <span style="color:#f92672">=</span> records[i];
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (level.find(cur.idHash) <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> intLat <span style="color:#f92672">=</span> cur.lat <span style="color:#f92672">/</span> <span style="color:#ae81ff">50</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> intLng <span style="color:#f92672">=</span> cur.lng <span style="color:#f92672">/</span> <span style="color:#ae81ff">50</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">bool</span> touch <span style="color:#f92672">=</span> false;
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">/*for (int d = -1; d &lt;= 1; d++) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                for (int e = -1; e &lt;= 1; e++) {*/</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> de <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; de <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">2</span>; de<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">int</span> id <span style="color:#f92672">=</span> ids.nodes[intLat <span style="color:#f92672">+</span> intLng <span style="color:#f92672">+</span> de].x;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">while</span> (id <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (cur.IsTouch(records[ids.nodes[id].x])) {
</span></span><span style="display:flex;"><span>                        level.insert(cur.idHash, <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>                        touch <span style="color:#f92672">=</span> true;
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                    id <span style="color:#f92672">=</span> ids.nodes[id].y;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (touch) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (de <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>                    id <span style="color:#f92672">=</span> ids.nodes[intLat <span style="color:#f92672">+</span> intLng <span style="color:#f92672">-</span> de].x;
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">while</span> (id <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">if</span> (cur.IsTouch(records[ids.nodes[id].x])) {
</span></span><span style="display:flex;"><span>                            level.insert(cur.idHash, <span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>                            touch <span style="color:#f92672">=</span> true;
</span></span><span style="display:flex;"><span>                            <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                        id <span style="color:#f92672">=</span> ids.nodes[id].y;
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (touch) {
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">            for (int d = -1; d &lt;= 1; d++) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                int id = latids.nodes[intLat + d].x;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                while (id != 0) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                    if (cur.IsTouch(records[latids.nodes[id].x])) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                        level.insert(cur.idHash, 2);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                        touch = true;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                        break;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                    }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                    id = latids.nodes[id].y;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                if (touch) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                    break;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                id = lngids.nodes[intLng + d].x;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                while (id != 0) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                    if (cur.IsTouch(records[lngids.nodes[id].x])) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                        level.insert(cur.idHash, 2);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                        touch = true;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                        break;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                    }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                    id = lngids.nodes[id].y;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                if (touch) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                    break;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">            }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    printf(<span style="color:#e6db74">&#34;touchCnt = %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, touchCnt);
</span></span><span style="display:flex;"><span>    printf(<span style="color:#e6db74">&#34;finish phase2 at %f s.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, (<span style="color:#66d9ef">double</span>) (clock() <span style="color:#f92672">-</span> st) <span style="color:#f92672">/</span> CLOCKS_PER_SEC);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    FILE <span style="color:#f92672">*</span>fo <span style="color:#f92672">=</span> fopen(outputFile, <span style="color:#e6db74">&#34;wb&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>outputBuffer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">char</span>[<span style="color:#ae81ff">1024</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1024</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>walk <span style="color:#f92672">=</span> outputBuffer;
</span></span><span style="display:flex;"><span>    (<span style="color:#f92672">*</span>walk<span style="color:#f92672">++</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;i&#39;</span>;
</span></span><span style="display:flex;"><span>    (<span style="color:#f92672">*</span>walk<span style="color:#f92672">++</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;d&#39;</span>;
</span></span><span style="display:flex;"><span>    (<span style="color:#f92672">*</span>walk<span style="color:#f92672">++</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;,&#39;</span>;
</span></span><span style="display:flex;"><span>    (<span style="color:#f92672">*</span>walk<span style="color:#f92672">++</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;l&#39;</span>;
</span></span><span style="display:flex;"><span>    (<span style="color:#f92672">*</span>walk<span style="color:#f92672">++</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span>;
</span></span><span style="display:flex;"><span>    (<span style="color:#f92672">*</span>walk<span style="color:#f92672">++</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;b&#39;</span>;
</span></span><span style="display:flex;"><span>    (<span style="color:#f92672">*</span>walk<span style="color:#f92672">++</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;e&#39;</span>;
</span></span><span style="display:flex;"><span>    (<span style="color:#f92672">*</span>walk<span style="color:#f92672">++</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;l&#39;</span>;
</span></span><span style="display:flex;"><span>    (<span style="color:#f92672">*</span>walk<span style="color:#f92672">++</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> recordSize; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (records[i].idHash <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> idHashSet.has(records[i].idHash)) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        idHashSet.insert(records[i].idHash);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>pos <span style="color:#f92672">=</span> records[i].pos; <span style="color:#f92672">*</span>pos <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;,&#39;</span>; pos<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            (<span style="color:#f92672">*</span>walk<span style="color:#f92672">++</span>) <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>pos;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        (<span style="color:#f92672">*</span>walk<span style="color:#f92672">++</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;,&#39;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">auto</span> it <span style="color:#f92672">=</span> level.find(records[i].idHash);
</span></span><span style="display:flex;"><span>        (<span style="color:#f92672">*</span>walk<span style="color:#f92672">++</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#f92672">+</span> (it <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">?</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">:</span> it);
</span></span><span style="display:flex;"><span>        (<span style="color:#f92672">*</span>walk<span style="color:#f92672">++</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;\n&#39;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (walk <span style="color:#f92672">-</span> outputBuffer <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">128</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1024</span>) {
</span></span><span style="display:flex;"><span>            fwrite(outputBuffer, <span style="color:#ae81ff">1</span>, walk <span style="color:#f92672">-</span> outputBuffer, fo);
</span></span><span style="display:flex;"><span>            walk <span style="color:#f92672">=</span> outputBuffer;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    fwrite(outputBuffer, <span style="color:#ae81ff">1</span>, walk <span style="color:#f92672">-</span> outputBuffer, fo);
</span></span><span style="display:flex;"><span>    fclose(fo);
</span></span><span style="display:flex;"><span>    printf(<span style="color:#e6db74">&#34;all spend %f s.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, (<span style="color:#66d9ef">double</span>) (clock() <span style="color:#f92672">-</span> st) <span style="color:#f92672">/</span> CLOCKS_PER_SEC);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    Record a, b;
</span></span><span style="display:flex;"><span>    a.lat <span style="color:#f92672">=</span> <span style="color:#ae81ff">3600000</span>;
</span></span><span style="display:flex;"><span>    a.lng <span style="color:#f92672">=</span> <span style="color:#ae81ff">11700000</span>;
</span></span><span style="display:flex;"><span>    b.lat <span style="color:#f92672">=</span> <span style="color:#ae81ff">3600020</span>;
</span></span><span style="display:flex;"><span>    b.lng <span style="color:#f92672">=</span> <span style="color:#ae81ff">11700000</span>;
</span></span><span style="display:flex;"><span>    printf(<span style="color:#e6db74">&#34;%f</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, a.getDist(b));
</span></span><span style="display:flex;"><span>    work(<span style="color:#e6db74">&#34;../data/record.csv&#34;</span>, <span style="color:#e6db74">&#34;../data/df_travel.csv&#34;</span>, <span style="color:#e6db74">&#34;../submit.csv&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
    </article>


    





    
    
    
        
    




<section id="articleNext" class="section nartrow">
    <h3 class="footer-next-heading">More articles from yzhn&#39;s Notes</h3>
    <div class="footer-spacer"></div>
    <div class="next-articles-grid" numberOfArticles={numberOfArticles}>
        <div class="post-row">
            
                <a href="/post/%E4%B8%AD%E7%A7%BB%E9%9B%86%E6%88%90%E9%9B%84%E5%AE%89%E4%BA%A7%E4%B8%9A%E7%A0%94%E7%A9%B6%E9%99%A2%E9%A6%96%E5%B1%8Aonecity%E7%BC%96%E7%A8%8B%E5%A4%A7%E8%B5%9B/" class="article-link"
                 id="article-link-bigger">
                    <div>
                        <div class="image-container">
                            <img src="" class="article-image" />
                        </div>
                        <div>
                            <h2 class="article-title">
                                中移集成（雄安产业研究院）首届OneCity编程大赛
                            </h2>
                            <p class="article-excerpt">
                                
                            </p>
                            <div class="article-metadata">
                                December 3, 2020 · 6 min read
                            </div>
                        </div>
                    </div>
                </a>
            
                <a href="/post/%E6%99%BA%E7%AE%97%E4%B9%8B%E9%81%932020%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E5%BA%94%E7%94%A8%E6%8C%91%E6%88%98%E8%B5%9B/" class="article-link"
                >
                    <div>
                        <div class="image-container">
                            <img src="" class="article-image" />
                        </div>
                        <div>
                            <h2 class="article-title">
                                智算之道——2020人工智能应用挑战赛
                            </h2>
                            <p class="article-excerpt">
                                
                            </p>
                            <div class="article-metadata">
                                October 10, 2020 · 2 min read
                            </div>
                        </div>
                    </div>
                </a>
            
        </div>
    </div>
</section>

</section>


 <script src="/js/progressBar.js"></script>

        
        <div class="footer-gradient"></div>
    <div class="section narrow">
      <div class="footer-hr"></div>
      <div class="footer-container">
        <div class="footer-text">
          © 2022 yzhn&#39;s Notes
        </div>
        <div class="social-icon-outer">
    <div class="social-icon-container">
        
            
                
                <a href="https://github.com/yzhn16/"><svg
class="social-icon-image"
width="14"
height="14"
viewBox="0 0 14 14"
fill="none"
xmlns="http://www.w3.org/2000/svg"
>
<path
  fillRule="evenodd"
  clipRule="evenodd"
  d="M7 0C3.1325 0 0 3.21173 0 7.17706C0 10.3529 2.00375 13.0353 4.78625 13.9863C5.13625 14.0491 5.2675 13.8338 5.2675 13.6454C5.2675 13.4749 5.25875 12.9097 5.25875 12.3087C3.5 12.6406 3.045 11.8691 2.905 11.4653C2.82625 11.259 2.485 10.622 2.1875 10.4516C1.9425 10.317 1.5925 9.98508 2.17875 9.97611C2.73 9.96714 3.12375 10.4964 3.255 10.7118C3.885 11.7973 4.89125 11.4923 5.29375 11.3039C5.355 10.8374 5.53875 10.5234 5.74 10.3439C4.1825 10.1645 2.555 9.54549 2.555 6.80026C2.555 6.01976 2.82625 5.37382 3.2725 4.87143C3.2025 4.692 2.9575 3.95635 3.3425 2.96951C3.3425 2.96951 3.92875 2.78111 5.2675 3.70516C5.8275 3.54367 6.4225 3.46293 7.0175 3.46293C7.6125 3.46293 8.2075 3.54367 8.7675 3.70516C10.1063 2.77214 10.6925 2.96951 10.6925 2.96951C11.0775 3.95635 10.8325 4.692 10.7625 4.87143C11.2087 5.37382 11.48 6.01079 11.48 6.80026C11.48 9.55446 9.84375 10.1645 8.28625 10.3439C8.54 10.5682 8.75875 10.9988 8.75875 11.6717C8.75875 12.6316 8.75 13.4032 8.75 13.6454C8.75 13.8338 8.88125 14.0581 9.23125 13.9863C11.9963 13.0353 14 10.3439 14 7.17706C14 3.21173 10.8675 0 7 0Z"
  fill="#73737D"
/>
</svg></a>
                <span class="hidden">https://github.com/yzhn16/</span>
            
        
    </div>
</div>
    </div>
</div>

    </div>

    
    <script src="/js/prism.js"></script>
</body>

</html>